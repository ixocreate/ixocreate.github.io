<!DOCTYPE html>
<html>
<head>
    
    <meta charset="UTF-8">
    <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>BlockContainerElement</title>
<meta name="generator" content="Jekyll v3.7.4" />
<meta property="og:title" content="BlockContainerElement" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="BlockContainerElement" />
<meta property="og:description" content="BlockContainerElement" />
<link rel="canonical" href="http://localhost:4000/docs/elements/BlockContainerElement/" />
<meta property="og:url" content="http://localhost:4000/docs/elements/BlockContainerElement/" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-02-11T10:25:23+01:00" />
<script type="application/ld+json">
{"description":"BlockContainerElement","@type":"BlogPosting","url":"http://localhost:4000/docs/elements/BlockContainerElement/","headline":"BlockContainerElement","dateModified":"2019-02-11T10:25:23+01:00","datePublished":"2019-02-11T10:25:23+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/docs/elements/BlockContainerElement/"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="/assets/css/style.css?v=">
</head>
<body>
<header class="page-header" role="banner">
    <h1 class="project-name">Ixocreate</h1>
</header>
<div class="con">
    <div class="menu">
        
        
        
        
        
        
            
            
                <ul>
                
                
                    <a href="/docs/index/"><h3>About</h3></a>
                    
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
                </ul>
            
        
            
            
                <ul>
                
                
                    <a href="/docs/install/"><h3>Install & setting up icocreate</h3></a>
                    
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
                    <a href="/docs/block/"><h3>Blocktype</h3></a>
                    
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
                    <a href="/docs/page/"><h3>Pagetype</h3></a>
                    
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
                    <a href="/docs/layout/"><h3>Layout</h3></a>
                    
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
                </ul>
            
        
            
            
                <ul>
                
                
                    <a href="/docs/guide-block-type/"><h3>Blocktype</h3></a>
                    
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
                    <a href="/docs/guide-page-type/"><h3>Pagetype</h3></a>
                    
                    
                    
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
                    <a href="/docs/guide-elements/"><h3>Elements</h3></a>
                    
                    
                    
                    
                        
                            <ul><a href="/docs/elements/AbstractElement/">AbstractElement</a></br></ul>
                        
                    
                        
                            <ul><a href="/docs/elements/AbstractGroup/">AbstractGroupElement</a></br></ul>
                        
                    
                        
                            <ul><a href="/docs/elements/AbstractSingleElement/">AbstractSingleElement</a></br></ul>
                        
                    
                        
                            <ul><a href="/docs/elements/AudioElement/">AudioElement</a></br></ul>
                        
                    
                        
                            <ul><a href="/docs/elements/BlockContainerElement/">BlockContainerElement</a></br></ul>
                        
                    
                        
                            <ul><a href="/docs/elements/CheckboxElement/">CheckboxElement</a></br></ul>
                        
                    
                        
                            <ul><a href="/docs/elements/CollectionElement/">CollectionElement</a></br></ul>
                        
                    
                        
                            <ul><a href="/docs/elements/ColorElement/">ColorElement</a></br></ul>
                        
                    
                        
                            <ul><a href="/docs/elements/DateElement/">DateElement</a></br></ul>
                        
                    
                        
                            <ul><a href="/docs/elements/DateTimeElement/">DateTimeElement</a></br></ul>
                        
                    
                        
                            <ul><a href="/docs/elements/DocumentElement/">DocumentElement</a></br></ul>
                        
                    
                        
                            <ul><a href="/docs/elements/GroupElement/">GroupElement</a></br></ul>
                        
                    
                        
                            <ul><a href="/docs/elements/HtmlElement/">HtmlElement</a></br></ul>
                        
                    
                        
                            <ul><a href="/docs/elements/ImageElement/">ImageElement</a></br></ul>
                        
                    
                        
                            <ul><a href="/docs/elements/LinkElement/">LinkElement</a></br></ul>
                        
                    
                        
                            <ul><a href="/docs/elements/MapElement/">MapElement</a></br></ul>
                        
                    
                        
                            <ul><a href="/docs/elements/MediaElement/">MediaElement</a></br></ul>
                        
                    
                        
                            <ul><a href="/docs/elements/MultiCheckboxElement/">MultiCheckboxElement</a></br></ul>
                        
                    
                        
                            <ul><a href="/docs/elements/MultiSelectElement/">MultiSelectElement</a></br></ul>
                        
                    
                        
                            <ul><a href="/docs/elements/NumberElement/">NumberElement</a></br></ul>
                        
                    
                        
                            <ul><a href="/docs/elements/PriceElement/">PriceElement</a></br></ul>
                        
                    
                        
                            <ul><a href="/docs/elements/RadioElement/">RadioElement</a></br></ul>
                        
                    
                        
                            <ul><a href="/docs/elements/SectionElement/">SectionElement</a></br></ul>
                        
                    
                        
                            <ul><a href="/docs/elements/SelectElement/">SelectElement</a></br></ul>
                        
                    
                        
                            <ul><a href="/docs/elements/TabbedGroupElement/">TabbedGroupElement</a></br></ul>
                        
                    
                        
                            <ul><a href="/docs/elements/TextElement/">TextElement</a></br></ul>
                        
                    
                        
                            <ul><a href="/docs/elements/TextareaElement/">TextareaElement</a></br></ul>
                        
                    
                        
                            <ul><a href="/docs/elements/VideoElement/">VideoElement</a></br></ul>
                        
                    
                        
                            <ul><a href="/docs/elements/YouTubeElement/">YouTubeElement</a></br></ul>
                        
                    
                
                </ul>
            
        
            
            
        
    </div>
    <div class="main">
        <main id="content" class="main-content" role="main">
            <h2 id="blockcontainerelement">BlockContainerElement</h2>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="cp">&lt;?php</span>
<span class="sd">/**
 * @link https://github.com/ixocreate
 * @copyright IXOCREATE GmbH
 * @license MIT License
 */</span>

<span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="k">namespace</span> <span class="nx">Ixocreate\Schema\Elements</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Ixocreate\Cms\Block\BlockInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Ixocreate\Cms\Block\BlockSubManager</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Ixocreate\CommonTypes\Entity\BlockContainerType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Ixocreate\Contract\Schema\ElementInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Ixocreate\Contract\Schema\SchemaInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Ixocreate\Contract\Type\TypeInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Ixocreate\Entity\Type\Type</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Ixocreate\Schema\Builder</span><span class="p">;</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">BlockContainerElement</span> <span class="k">extends</span> <span class="nx">AbstractGroup</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nv">$blocks</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="sd">/**
     * @var BlockSubManager
     */</span>
    <span class="k">private</span> <span class="nv">$blockSubManager</span><span class="p">;</span>

    <span class="sd">/**
     * @var Builder
     */</span>
    <span class="k">private</span> <span class="nv">$builder</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">BlockSubManager</span> <span class="nv">$blockSubManager</span><span class="p">,</span> <span class="nx">Builder</span> <span class="nv">$builder</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">blockSubManager</span> <span class="o">=</span> <span class="nv">$blockSubManager</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">builder</span> <span class="o">=</span> <span class="nv">$builder</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">type</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">BlockContainerType</span><span class="o">::</span><span class="na">class</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">inputType</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">'blockContainer'</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">serviceName</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">'blockContainer'</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">withBlocks</span><span class="p">(</span><span class="k">array</span> <span class="nv">$blocks</span><span class="p">)</span><span class="o">:</span> <span class="nx">BlockContainerElement</span>
    <span class="p">{</span>
        <span class="nv">$element</span> <span class="o">=</span> <span class="k">clone</span> <span class="nv">$this</span><span class="p">;</span>
        <span class="nv">$element</span><span class="o">-&gt;</span><span class="na">blocks</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parseBlockOption</span><span class="p">(</span><span class="nv">$blocks</span><span class="p">);</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$element</span><span class="o">-&gt;</span><span class="na">blocks</span> <span class="k">as</span> <span class="nv">$block</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$element</span> <span class="o">=</span> <span class="nv">$element</span><span class="o">-&gt;</span><span class="na">addBlockElement</span><span class="p">(</span><span class="nv">$block</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$element</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">blocks</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">blocks</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**
     * @param ElementInterface $element
     * @throws \Exception
     * @return SchemaInterface
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">withAddedElement</span><span class="p">(</span><span class="nx">ElementInterface</span> <span class="nv">$element</span><span class="p">)</span><span class="o">:</span> <span class="nx">SchemaInterface</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nv">$element</span> <span class="nx">instanceof</span> <span class="nx">GroupElement</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">\Exception</span><span class="p">(</span><span class="s2">"Element must be a GroupElement"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">parent</span><span class="o">::</span><span class="na">withAddedElement</span><span class="p">(</span><span class="nv">$element</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">jsonSerialize</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$array</span> <span class="o">=</span> <span class="k">parent</span><span class="o">::</span><span class="na">jsonSerialize</span><span class="p">();</span>
        <span class="nv">$array</span><span class="p">[</span><span class="s1">'blocks'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">blocks</span><span class="p">();</span>

        <span class="k">return</span> <span class="nv">$array</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">transform</span><span class="p">(</span><span class="nv">$data</span><span class="p">)</span><span class="o">:</span> <span class="nx">TypeInterface</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Type</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="nx">BlockContainerType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="p">[</span><span class="s1">'schema'</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="p">,</span> <span class="s1">'blocks'</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">blocks</span><span class="p">()]);</span>
    <span class="p">}</span>

    <span class="sd">/**
     * @param array $blocks
     * @return array
     */</span>
    <span class="k">private</span> <span class="k">function</span> <span class="nf">parseBlockOption</span><span class="p">(</span><span class="k">array</span> <span class="nv">$blocks</span><span class="p">)</span><span class="o">:</span> <span class="k">array</span>
    <span class="p">{</span>
        <span class="c1">//TODO duplicate code!!!
</span>        <span class="nv">$parsedBlocks</span> <span class="o">=</span> <span class="p">[];</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$blocks</span> <span class="k">as</span> <span class="nv">$blockName</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">\mb_strpos</span><span class="p">(</span><span class="nv">$blockName</span><span class="p">,</span> <span class="s1">'*'</span><span class="p">)</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">\array_key_exists</span><span class="p">(</span><span class="nv">$blockName</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">blockSubManager</span><span class="o">-&gt;</span><span class="na">getServiceManagerConfig</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getNamedServices</span><span class="p">()))</span> <span class="p">{</span>
                    <span class="nv">$parsedBlocks</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$blockName</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="nv">$beginningPart</span> <span class="o">=</span> <span class="nx">\mb_substr</span><span class="p">(</span><span class="nv">$blockName</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">\mb_strpos</span><span class="p">(</span><span class="nv">$blockName</span><span class="p">,</span> <span class="s1">'*'</span><span class="p">));</span>

            <span class="k">foreach</span> <span class="p">(</span><span class="nx">\array_keys</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">blockSubManager</span><span class="o">-&gt;</span><span class="na">getServiceManagerConfig</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getNamedServices</span><span class="p">())</span> <span class="k">as</span> <span class="nv">$mappingBlock</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">\mb_substr</span><span class="p">(</span><span class="nv">$mappingBlock</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">\mb_strlen</span><span class="p">(</span><span class="nv">$beginningPart</span><span class="p">))</span> <span class="o">===</span> <span class="nv">$beginningPart</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$parsedBlocks</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$mappingBlock</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$parsedBlocks</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">function</span> <span class="nf">addBlockElement</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$block</span><span class="p">)</span><span class="o">:</span> <span class="nx">ElementInterface</span>
    <span class="p">{</span>
        <span class="sd">/** @var BlockInterface $blockObj */</span>
        <span class="nv">$blockObj</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">blockSubManager</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$block</span><span class="p">);</span>

        <span class="nv">$schema</span> <span class="o">=</span> <span class="nv">$blockObj</span><span class="o">-&gt;</span><span class="na">receiveSchema</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">builder</span><span class="p">);</span>

        <span class="nv">$group</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">builder</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">(</span><span class="nx">GroupElement</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$block</span><span class="p">);</span>
        <span class="nv">$group</span> <span class="o">=</span> <span class="nv">$group</span><span class="o">-&gt;</span><span class="na">withLabel</span><span class="p">(</span><span class="nv">$blockObj</span><span class="o">-&gt;</span><span class="na">label</span><span class="p">());</span>
        <span class="nv">$group</span> <span class="o">=</span> <span class="nv">$group</span><span class="o">-&gt;</span><span class="na">withElements</span><span class="p">(</span><span class="nv">$schema</span><span class="o">-&gt;</span><span class="na">elements</span><span class="p">());</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">withAddedElement</span><span class="p">(</span><span class="nv">$group</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

        </main>
    </div>
</div>
</body>
</html>